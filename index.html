<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ„ CH X å’ªå–µ ç¬¬ä¸€å±†-æˆ‘è¦åšMODEL</title>
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Comic Sans MS','Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#ff6b6b 0%,#4ecdc4 50%,#ffe66d 100%);background-size:400% 400%;animation:gradientShift 15s ease infinite;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;position:relative;overflow-x:hidden}@keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}body::before,body::after{content:'â„ï¸ â­ ğŸ„ â„ï¸ â­ ğŸ„ â„ï¸ â­ ğŸ„ â„ï¸ â­ ğŸ„';position:fixed;left:0;right:0;font-size:30px;opacity:.3;white-space:nowrap;pointer-events:none}body::before{top:-50px;animation:snowfall 20s linear infinite}body::after{bottom:-50px;animation:snowfall-reverse 20s linear infinite}@keyframes snowfall{0%{transform:translateY(0) translateX(0)}100%{transform:translateY(100vh) translateX(100px)}}@keyframes snowfall-reverse{0%{transform:translateY(0) translateX(100px)}100%{transform:translateY(-100vh) translateX(0)}}.container{background:white;border-radius:30px;box-shadow:0 20px 60px rgba(0,0,0,.2),0 0 0 8px #ff6b6b,0 0 0 16px #4ecdc4;padding:40px;max-width:700px;width:100%;animation:fadeIn .5s ease-in,float 3s ease-in-out infinite;position:relative}@keyframes fadeIn{from{opacity:0;transform:translateY(-20px) scale(.9)}to{opacity:1;transform:translateY(0) scale(1)}}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}.container::before{content:'ğŸ„';position:absolute;top:-30px;left:20px;font-size:50px;animation:wiggle 2s ease-in-out infinite}.container::after{content:'ğŸ…';position:absolute;top:-30px;right:20px;font-size:50px;animation:wiggle 2s ease-in-out infinite .5s}@keyframes wiggle{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}h1{background:linear-gradient(135deg,#ff6b6b 0%,#4ecdc4 50%,#ffe66d 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center;margin-bottom:20px;font-size:26px;font-weight:bold;position:relative}h1::before,h1::after{content:'â­';position:absolute;animation:twinkle 1.5s ease-in-out infinite}h1::before{left:0}h1::after{right:0;animation-delay:.75s}@keyframes twinkle{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.2)}}.theme-display{background:linear-gradient(135deg,#ff6b6b 0%,#ff8e53 100%);color:white;padding:20px;border-radius:20px;text-align:center;margin-bottom:15px;font-size:20px;font-weight:bold;box-shadow:0 8px 20px rgba(255,107,107,.3);position:relative;overflow:hidden}.theme-display::before,.theme-display::after{content:'ğŸ';position:absolute;font-size:30px;animation:bounce 1s ease-in-out infinite}.theme-display::before{left:10px}.theme-display::after{right:10px;animation-delay:.5s}@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}.submission-notice{background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 100%);color:#1565c0;padding:12px 20px;border-radius:15px;text-align:center;margin-bottom:30px;font-size:14px;font-weight:bold;border:3px solid #2196f3;box-shadow:0 4px 15px rgba(33,150,243,.2)}.submission-notice::before{content:'ğŸ“¢ '}.input-group{margin-bottom:20px}label{display:block;color:#ff6b6b;margin-bottom:8px;font-weight:bold;font-size:16px}label::before{content:'ğŸ° '}input,textarea{width:100%;padding:15px;border:3px solid #4ecdc4;border-radius:20px;font-size:16px;transition:all .3s;background:#fff;font-family:'Comic Sans MS',sans-serif}input:focus,textarea:focus{outline:none;border-color:#ff6b6b;box-shadow:0 0 0 4px rgba(255,107,107,.2);transform:scale(1.02)}button{width:100%;padding:18px;background:linear-gradient(135deg,#ff6b6b 0%,#ff8e53 100%);color:white;border:none;border-radius:25px;font-size:18px;font-weight:bold;cursor:pointer;transition:all .3s;margin-bottom:12px;box-shadow:0 8px 20px rgba(255,107,107,.3);position:relative;overflow:hidden}button:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(255,107,107,.4)}button:disabled{opacity:.5;cursor:not-allowed}.secondary-btn{background:linear-gradient(135deg,#4ecdc4 0%,#44a08d 100%);box-shadow:0 8px 20px rgba(78,205,196,.3)}.stats{display:flex;justify-content:space-around;margin-bottom:30px;padding:20px;background:linear-gradient(135deg,#ffe66d 0%,#ffb347 100%);border-radius:20px;box-shadow:0 8px 20px rgba(255,230,109,.3)}.stat-item{text-align:center}.stat-number{font-size:36px;font-weight:bold;color:#ff6b6b;text-shadow:2px 2px 4px rgba(0,0,0,.1);animation:pulse 2s ease-in-out infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.stat-label{color:#666;margin-top:5px;font-weight:bold}.images-container{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px}.image-option{position:relative;cursor:pointer;border-radius:20px;overflow:hidden;transition:all .3s;border:4px solid #4ecdc4;box-shadow:0 8px 20px rgba(0,0,0,.2);background:white;aspect-ratio:1/1}.image-option:hover{transform:scale(1.05);border-color:#ff6b6b;box-shadow:0 12px 30px rgba(255,107,107,.4)}.image-option img{width:100%;height:100%;display:block;object-fit:cover;object-position:center}.image-option-title{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,rgba(0,0,0,.8),transparent);color:white;padding:15px 10px 10px;font-weight:bold;font-size:14px;text-align:center}.admin-container{max-width:1200px}.admin-section{margin-bottom:30px;padding:25px;background:linear-gradient(135deg,#fff 0%,#f8f9fa 100%);border-radius:20px;border:3px solid #4ecdc4;box-shadow:0 8px 20px rgba(0,0,0,.1)}.admin-section h2{color:#ff6b6b;margin-bottom:20px;font-size:24px}.admin-section h2::before{content:'ğŸ„ '}.setup-box{background:linear-gradient(135deg,#fff3e0 0%,#ffe0b2 100%);padding:20px;border-radius:15px;margin-bottom:20px;border:3px solid #ff9800}.setup-box h3{color:#e65100;margin-bottom:15px;font-size:18px}.setup-box h3::before{content:'âš™ï¸ '}.setup-box p{color:#555;margin:10px 0;line-height:1.6}.toggle-container{display:flex;align-items:center;justify-content:space-between;padding:15px;background:white;border-radius:15px;margin:15px 0;border:3px solid #4ecdc4}.toggle-label{font-weight:bold;color:#ff6b6b;font-size:16px}.toggle-switch{position:relative;width:60px;height:30px;background:#ccc;border-radius:30px;cursor:pointer;transition:all .3s}.toggle-switch.active{background:linear-gradient(135deg,#4ecdc4 0%,#44a08d 100%)}.toggle-switch::after{content:'';position:absolute;width:24px;height:24px;background:white;border-radius:50%;top:3px;left:3px;transition:all .3s;box-shadow:0 2px 5px rgba(0,0,0,.2)}.toggle-switch.active::after{left:33px}.time-status{background:white;padding:15px;border-radius:15px;margin:15px 0;border:3px solid #4ecdc4}.time-status-item{display:flex;justify-content:space-between;align-items:center;margin:8px 0;padding:8px 0;border-bottom:1px solid #f0f0f0}.time-status-item:last-child{border-bottom:none}.time-status-label{color:#666;font-weight:bold;font-size:14px}.time-status-value{color:#ff6b6b;font-weight:bold;font-size:14px}.time-status-value.active{color:#2e7d32}.time-status-value.inactive{color:#c62828}.token-status{display:inline-block;padding:5px 15px;border-radius:10px;font-weight:bold;margin-left:10px}.token-status.configured{background:#c8e6c9;color:#2e7d32}.token-status.not-configured{background:#ffcdd2;color:#c62828}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:9999;animation:fadeIn .3s ease}.confirm-modal{background:white;border-radius:30px;padding:40px;max-width:500px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,.3),0 0 0 8px #ff6b6b,0 0 0 16px #4ecdc4;animation:scaleIn .3s ease;text-align:center}@keyframes scaleIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}.confirm-modal h2{color:#ff6b6b;font-size:28px;margin-bottom:20px}.confirm-modal h2::before{content:'ğŸ '}.confirm-image{width:100%;max-width:300px;height:300px;object-fit:cover;border-radius:20px;margin:20px auto;border:4px solid #4ecdc4;box-shadow:0 8px 20px rgba(0,0,0,.2)}.confirm-title{font-size:20px;color:#ff6b6b;font-weight:bold;margin:15px 0}.confirm-text{color:#666;font-size:16px;margin:15px 0;line-height:1.6}.confirm-buttons{display:flex;gap:15px;margin-top:30px}.confirm-buttons button{flex:1;margin:0}.success-modal{background:linear-gradient(135deg,#e8f5e9 0%,#c8e6c9 100%);border:4px solid #66bb6a;animation:successPop .5s ease}@keyframes successPop{0%{transform:scale(.5) rotate(-5deg);opacity:0}50%{transform:scale(1.1) rotate(2deg)}100%{transform:scale(1) rotate(0)}}.success-modal h2{color:#2e7d32;font-size:32px;margin-bottom:20px;animation:bounce 1s ease infinite}.success-modal h2::before{content:'âœ¨ '}.success-icon{font-size:80px;margin:20px 0;animation:rotate 2s ease}.success-icon::before{content:'ğŸ‰'}@keyframes rotate{0%{transform:rotate(0) scale(1)}25%{transform:rotate(-10deg) scale(1.1)}50%{transform:rotate(10deg) scale(1.2)}75%{transform:rotate(-5deg) scale(1.1)}100%{transform:rotate(0) scale(1)}}.success-message{font-size:18px;color:#2e7d32;font-weight:bold;margin:20px 0}.file-input-wrapper{position:relative;overflow:hidden;display:inline-block;width:100%}.file-input-wrapper input[type=file]{position:absolute;left:-9999px}.file-input-label{display:block;padding:20px;background:linear-gradient(135deg,#ffe66d 0%,#ffb347 100%);border:3px dashed #ff6b6b;border-radius:15px;text-align:center;cursor:pointer;transition:all .3s;font-weight:bold;color:#ff6b6b}.file-input-label:hover{background:linear-gradient(135deg,#ffb347 0%,#ffe66d 100%);transform:scale(1.02);box-shadow:0 4px 15px rgba(255,107,107,.3)}.preview-image{max-width:100%;max-height:300px;margin-top:15px;border-radius:15px;border:4px solid #4ecdc4;box-shadow:0 4px 15px rgba(0,0,0,.2)}.file-size-info{font-size:12px;color:#999;margin-top:5px}.submissions-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:20px}.submission-card{background:white;border-radius:15px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,.1);border:3px solid #ffe66d;transition:all .3s}.submission-card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(255,107,107,.3);border-color:#ff6b6b}.submission-card img{width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:10px;margin-bottom:15px;border:2px solid #4ecdc4}.submission-info{font-size:14px;color:#666;margin:5px 0;font-weight:bold}.submission-title{font-size:18px;color:#ff6b6b;font-weight:bold;margin-bottom:10px}.vote-records{background:#f8f9fa;padding:15px;border-radius:10px;margin:15px 0;max-height:300px;overflow-y:auto}.vote-records h4{color:#4ecdc4;margin-bottom:10px;font-size:16px}.vote-records h4::before{content:'ğŸ“Š '}.vote-record-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:white;border-radius:8px;margin:5px 0;border:2px solid #e0e0e0;transition:all .3s}.vote-record-item:hover{border-color:#ff6b6b;transform:translateX(5px)}.voter-name{font-weight:bold;color:#333;flex:1}.vote-time{font-size:12px;color:#999;margin-right:10px}.delete-vote-btn{background:linear-gradient(135deg,#ff6b6b 0%,#ee5a6f 100%);padding:5px 12px;font-size:12px;border-radius:8px;cursor:pointer;border:none;color:white;font-weight:bold;transition:all .3s;width:auto;margin:0}.delete-vote-btn:hover{transform:scale(1.1);box-shadow:0 4px 15px rgba(255,107,107,.4)}.delete-btn{background:linear-gradient(135deg,#ff6b6b 0%,#ee5a6f 100%);padding:10px 15px;font-size:14px;margin-top:10px}.leaderboard-container{max-width:600px}.leaderboard-notice{background:linear-gradient(135deg,#fff3e0 0%,#ffe0b2 100%);padding:15px 20px;border-radius:15px;margin-bottom:20px;border:3px solid #ff9800;text-align:center}.leaderboard-notice-title{color:#e65100;font-weight:bold;font-size:16px;margin-bottom:8px}.leaderboard-notice-title::before{content:'âš ï¸ '}.leaderboard-notice-text{color:#666;font-size:14px;line-height:1.6}.leaderboard-update-time{background:linear-gradient(135deg,#e3f2fd 0%,#bbdefb 100%);padding:12px 20px;border-radius:15px;margin-bottom:20px;border:3px solid #2196f3;text-align:center;color:#1565c0;font-weight:bold;font-size:14px}.leaderboard-update-time::before{content:'ğŸ• '}.leaderboard-item{display:flex;align-items:center;padding:20px;background:linear-gradient(135deg,#fff 0%,#f8f9fa 100%);border-radius:20px;margin-bottom:15px;transition:all .3s;border:3px solid #4ecdc4;box-shadow:0 4px 15px rgba(0,0,0,.1)}.leaderboard-item:hover{transform:translateX(10px);border-color:#ff6b6b;box-shadow:0 8px 25px rgba(255,107,107,.3)}.rank{font-size:28px;font-weight:bold;background:linear-gradient(135deg,#ff6b6b 0%,#ffe66d 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;width:60px}.leaderboard-image{width:80px;height:80px;object-fit:cover;border-radius:15px;margin-right:15px;border:3px solid #4ecdc4}.leaderboard-info{flex:1}.leaderboard-title{font-weight:bold;margin-bottom:5px;color:#ff6b6b;font-size:18px}.leaderboard-score{color:#666;font-weight:bold}.error{background:linear-gradient(135deg,#ffebee 0%,#ffcdd2 100%);color:#c62828;padding:18px;border-radius:15px;margin-bottom:20px;text-align:center;font-weight:bold;border:3px solid #ef5350;box-shadow:0 4px 15px rgba(198,40,40,.2)}.error::before{content:'âŒ '}.success{background:linear-gradient(135deg,#e8f5e9 0%,#c8e6c9 100%);color:#2e7d32;padding:18px;border-radius:15px;margin-bottom:20px;text-align:center;font-weight:bold;border:3px solid #66bb6a;box-shadow:0 4px 15px rgba(46,125,50,.2)}.success::before{content:'âœ¨ '}.hidden{display:none}.loading{text-align:center;padding:40px;color:#ff6b6b;font-size:20px;font-weight:bold}.loading::before{content:'ğŸ„ ';animation:spin 2s linear infinite;display:inline-block}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}.user-info{background:linear-gradient(135deg,#ffe66d 0%,#ffb347 100%);padding:20px;border-radius:20px;margin-bottom:20px;text-align:center;font-weight:bold;color:#ff6b6b;font-size:18px;border:3px solid #ff6b6b;box-shadow:0 4px 15px rgba(255,230,109,.3)}.user-info::before{content:'ğŸ… '}.logout-btn{background:linear-gradient(135deg,#ff6b6b 0%,#ee5a6f 100%);padding:12px 25px;font-size:14px;margin-top:10px;display:inline-block;width:auto}.christmas-lights{position:fixed;top:0;left:0;right:0;height:20px;background:repeating-linear-gradient(90deg,#ff6b6b 0,#ff6b6b 20px,#4ecdc4 20px,#4ecdc4 40px,#ffe66d 40px,#ffe66d 60px);z-index:1000}.progress-bar{width:100%;height:30px;background:#f0f0f0;border-radius:15px;overflow:hidden;margin:15px 0;border:3px solid #4ecdc4}.progress-fill{height:100%;background:linear-gradient(135deg,#4ecdc4 0%,#44a08d 100%);transition:width .3s;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold}.no-votes{text-align:center;color:#999;font-style:italic;padding:10px}@media (max-width:768px){.container{padding:20px}h1{font-size:20px}.stat-number{font-size:28px}.images-container{grid-template-columns:1fr}.confirm-modal{padding:20px}.confirm-buttons{flex-direction:column}}</style>
</head>
<body>
<div class="christmas-lights"></div>
<div id="app" class="container"><div class="loading">è¼‰å…¥ä¸­...</div></div>
<script type="module">import{initializeApp as t}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getFirestore as e,collection as a,doc as i,getDoc as n,setDoc as o,getDocs as s,deleteDoc as r,updateDoc as l,increment as d,query as c,orderBy as m,limit as g,arrayUnion as u,arrayRemove as p}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{getAuth as v,signInWithEmailAndPassword as h,signOut as f,onAuthStateChanged as b}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";const y={apiKey:"AIzaSyBVlLiHWQQ7Sr-d_Rwdavwjojp2IXH_Gug",authDomain:"ch-mimeow.firebaseapp.com",projectId:"ch-mimeow",storageBucket:"ch-mimeow.firebasestorage.app",messagingSenderId:"633558087640",appId:"1:633558087640:web:b4aca508115aff9ad224ad"},w={owner:"Andy080852",repo:"fashion-voting",branch:"main",path:"images"},x=t(y),k=e(x),S=v(x);let T=null,A=null,E=null,L=[],I=localStorage.getItem("githubToken")||"";async function C(){try{b(S,async t=>{t?(A=t,await M(),D()):(A=null,await M(),_())})}catch(t){console.error("åˆå§‹åŒ–å¤±æ•—:",t),R("ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢")}}async function M(){try{const t=await n(i(k,"settings","config"));t.exists()?E=t.data():(E={theme:"ğŸ„ è–èª•å¿«æ¨‚ â„ï¸",maxVotes:5,maxRefreshes:15,showLeaderboardImages:!0,votingStartTime:null,votingEndTime:null},await o(i(k,"settings","config"),E))}catch(t){console.error("è¼‰å…¥è¨­å®šå¤±æ•—:",t),R("è¼‰å…¥è¨­å®šå¤±æ•—")}}function P(){if(!E.votingStartTime&&!E.votingEndTime)return!0;const t=Date.now(),e=E.votingStartTime?new Date(E.votingStartTime).getTime():0,a=E.votingEndTime?new Date(E.votingEndTime).getTime():1/0;return t>=e&&t<=a}function N(){if(!E.votingStartTime&&!E.votingEndTime)return{status:"always",message:"ç„¡æ™‚é–“é™åˆ¶"};const t=Date.now(),e=E.votingStartTime?new Date(E.votingStartTime).getTime():0,a=E.votingEndTime?new Date(E.votingEndTime).getTime():1/0;return t<e?{status:"notStarted",message:"æŠ•ç¥¨å°šæœªé–‹å§‹"}:t>a?{status:"ended",message:"æŠ•ç¥¨å·²çµæŸ"}:{status:"active",message:"æŠ•ç¥¨é€²è¡Œä¸­"}}async function U(t){if(!I)throw new Error("è«‹å…ˆè¨­å®š GitHub Token");const e=new FileReader,a=new Promise((t,a)=>{e.onload=()=>{const e=e.result.split(",")[1];t(e)},e.onerror=a,e.readAsDataURL(t)}),i=await a,n=Date.now(),o=`${n}_${t.name}`,s=`${w.path}/${o}`,r=await fetch(`https://api.github.com/repos/${w.owner}/${w.repo}/contents/${s}`,{method:"PUT",headers:{Authorization:`token ${I}`,"Content-Type":"application/json"},body:JSON.stringify({message:`Upload ${o}`,content:i,branch:w.branch})});if(!r.ok){const t=await r.json();throw new Error(t.message||"ä¸Šå‚³å¤±æ•—")}const l=await r.json();return{url:`https://raw.githubusercontent.com/${w.owner}/${w.repo}/${w.branch}/${s}`,sha:l.content.sha,path:s}}async function j(t){if(!I||!t)return;try{const e=await fetch(`https://api.github.com/repos/${w.owner}/${w.repo}/contents/${t}`,{headers:{Authorization:`token ${I}`}});if(!e.ok)return;const a=await e.json();await fetch(`https://api.github.com/repos/${w.owner}/${w.repo}/contents/${t}`,{method:"DELETE",headers:{Authorization:`token ${I}`,"Content-Type":"application/json"},body:JSON.stringify({message:`Delete ${t}`,sha:a.sha,branch:w.branch})})}catch(t){console.error("åˆªé™¤åœ–ç‰‡å¤±æ•—:",t)}}function _(){const t=document.getElementById("app");t.className="container";const e=N(),a=P();t.innerHTML=`<h1>ğŸ„ CH X å’ªå–µ ç¬¬ä¸€å±†<br>æˆ‘è¦åšMODEL ğŸ…</h1>${E?`<div class="theme-display">${E.theme}</div>`:""}<div class="submission-notice">æœ‰èˆˆè¶£æŠ•ç¨¿è«‹åˆ° DC è¯çµ¡ CH-æ™‚</div>${a?"":`<div class="error">${e.message}<br>${"notStarted"===e.status&&E.votingStartTime?`é–‹å§‹æ™‚é–“ï¼š${new Date(E.votingStartTime).toLocaleString("zh-TW")}`:""} ${"ended"===e.status&&E.votingEndTime?`çµæŸæ™‚é–“ï¼š${new Date(E.votingEndTime).toLocaleString("zh-TW")}`:""}</div>`}<div class="input-group"><label>è«‹è¼¸å…¥ä½ çš„å§“å</label><input type="text" id="userName" placeholder="è¼¸å…¥å§“å" ${a?"":"disabled"}></div><button onclick="window.userLogin()" ${a?"":"disabled"}>${a?"ğŸ é–‹å§‹æŠ•ç¥¨":"âŒ æŠ•ç¥¨æœªé–‹æ”¾"}</button><button class="secondary-btn" onclick="window.showAdminLogin()">âš™ï¸ å¾Œå°ç®¡ç†</button><button class="secondary-btn" onclick="window.showLeaderboard()">ğŸ† æŸ¥çœ‹æ’è¡Œæ¦œ</button>`}async function D(){const t=document.getElementById("app");t.className="container admin-container";const e=await s(a(k,"submissions"));L=e.docs.map(t=>({id:t.id,...t.data()}));const n=I?"configured":"not-configured",r=I?"âœ“ å·²è¨­å®š":"âœ— æœªè¨­å®š",d=t=>{if(!t)return"æœªè¨­å®š";return new Date(t).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},c=N();t.innerHTML=`<h1>ğŸ„ å¾Œå°ç®¡ç† ğŸ…</h1><div class="user-info">${A.email}<button class="logout-btn" onclick="window.adminLogout()">ç™»å‡º</button></div><div class="setup-box"><h3>GitHub Token è¨­å®š <span class="token-status ${n}">${r}</span></h3><p>ç‚ºäº†è‡ªå‹•ä¸Šå‚³åœ–ç‰‡åˆ° GitHubï¼Œéœ€è¦è¨­å®š Personal Access Tokenã€‚</p><div class="input-group" style="margin-top:15px"><label>GitHub Token</label><input type="password" id="githubTokenInput" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" value="${I}"></div><button onclick="window.saveGitHubToken()">ğŸ’¾ å„²å­˜ Token</button>${I?'<button class="secondary-btn" onclick="window.clearGitHubToken()">ğŸ—‘ï¸ æ¸…é™¤ Token</button>':""}</div><div class="admin-section"><h2>ä¸»é¡Œè¨­å®š</h2><div class="input-group"><label>ç•¶å‰ä¸»é¡Œ</label><input type="text" id="themeInput" value="${E.theme}"></div><button onclick="window.updateTheme()">ğŸ æ›´æ–°ä¸»é¡Œ</button></div><div class="admin-section"><h2>æŠ•ç¥¨æ™‚é–“è¨­å®š</h2><div class="time-status"><div class="time-status-item"><span class="time-status-label">ğŸ“… ç•¶å‰ç‹€æ…‹</span><span class="time-status-value ${"active"===c.status?"active":"inactive"}">${c.message}</span></div><div class="time-status-item"><span class="time-status-label">ğŸ• é–‹å§‹æ™‚é–“</span><span class="time-status-value">${d(E.votingStartTime)}</span></div><div class="time-status-item"><span class="time-status-label">ğŸ• çµæŸæ™‚é–“</span><span class="time-status-value">${d(E.votingEndTime)}</span></div></div><div class="input-group"><label>é–‹å§‹æ™‚é–“</label><input type="datetime-local" id="startTimeInput" value="${E.votingStartTime||""}"></div><div class="input-group"><label>çµæŸæ™‚é–“</label><input type="datetime-local" id="endTimeInput" value="${E.votingEndTime||""}"></div><button onclick="window.updateVotingTime()">â° æ›´æ–°æŠ•ç¥¨æ™‚é–“</button><button class="secondary-btn" onclick="window.clearVotingTime()">ğŸ—‘ï¸ æ¸…é™¤æ™‚é–“é™åˆ¶</button></div><div class="admin-section"><h2>æ’è¡Œæ¦œè¨­å®š</h2><div class="toggle-container"><span class="toggle-label">ğŸ–¼ï¸ æ’è¡Œæ¦œé¡¯ç¤ºåœ–ç‰‡</span><div class="toggle-switch ${E.showLeaderboardImages?"active":""}" onclick="window.toggleLeaderboardImages()"></div></div><p style="color:#666;font-size:14px;margin-top:10px">${E.showLeaderboardImages?"âœ… ç›®å‰ï¼šé¡¯ç¤ºåœ–ç‰‡":"âŒ ç›®å‰ï¼šä¸é¡¯ç¤ºåœ–ç‰‡"}</p></div><div class="admin-section"><h2>ä¸Šå‚³ä½œå“</h2><div class="input-group"><label>ä½œå“æ¨™é¡Œ</label><input type="text" id="submissionTitle" placeholder="è¼¸å…¥ä½œå“æ¨™é¡Œ"></div><div class="input-group"><label>é¸æ“‡åœ–ç‰‡</label><div class="file-input-wrapper"><input type="file" id="submissionImage" accept="image/jpeg,image/jpg,image/png,image/webp" onchange="window.previewImage(event)"><label for="submissionImage" class="file-input-label">ğŸ“ é»æ“Šä¸Šå‚³åœ–ç‰‡<div class="file-size-info">æ”¯æ´ JPG/PNG/WebPï¼Œå»ºè­°å°æ–¼ 2 MB</div></label></div><img id="imagePreview" class="preview-image hidden"><div id="fileSizeDisplay" class="file-size-info"></div></div><div id="uploadProgress" class="progress-bar hidden"><div id="uploadProgressFill" class="progress-fill" style="width:0%">0%</div></div><button id="uploadBtn" onclick="window.uploadSubmission()" ${I?"":"disabled"}>${I?"ğŸ ä¸Šå‚³ä½œå“":"âš ï¸ è«‹å…ˆè¨­å®š GitHub Token"}</button></div><div class="admin-section"><h2>ä½œå“ç®¡ç†èˆ‡æŠ•ç¥¨è¨˜éŒ„</h2><div class="submissions-grid">${L.map(t=>{const e=t.votes||[];return`<div class="submission-card"><img src="${t.imageUrl}" alt="${t.title}"><div class="submission-title">${t.title}</div><div class="submission-info">â­ ç¸½åˆ†æ•¸: ${t.score||0}</div><div class="submission-info">ğŸ“Š æŠ•ç¥¨æ•¸: ${e.length}</div><div class="vote-records"><h4>æŠ•ç¥¨è¨˜éŒ„</h4>${e.length>0?e.map(e=>`<div class="vote-record-item"><span class="voter-name">ğŸ‘¤ ${e.voter}</span><span class="vote-time">${e.date}</span><button class="delete-vote-btn" onclick='window.deleteVote("${t.id}", ${JSON.stringify(e).replace(/'/g,"&apos;")})'>ğŸ—‘ï¸</button></div>`).join(""):'<div class="no-votes">æš«ç„¡æŠ•ç¥¨è¨˜éŒ„</div>'}</div><button class="delete-btn" onclick="window.deleteSubmission('${t.id}', '${t.imagePath||""}')">ğŸ—‘ï¸ åˆªé™¤ä½œå“</button></div>`}).join("")}</div>${0===L.length?'<p style="text-align:center;color:#999">æš«ç„¡ä½œå“</p>':""}</div><div class="admin-section"><h2>æ’è¡Œæ¦œç®¡ç†</h2><button onclick="window.updateLeaderboard()">ğŸ”„ æ›´æ–°æ’è¡Œæ¦œ</button></div>`}async function O(){if(!P())return R("ç›®å‰ä¸åœ¨æŠ•ç¥¨æ™‚é–“å…§"),void _();const t=await s(a(k,"submissions"));L=t.docs.map(t=>({id:t.id,...t.data()}));const e=document.getElementById("app");e.className="container",e.innerHTML=`<h1>ğŸ„ æŠ•ç¥¨ç³»çµ± ğŸ…</h1><div class="user-info">${T.name}</div><div class="stats"><div class="stat-item"><div class="stat-number">${T.votesRemaining}</div><div class="stat-label">ğŸ å‰©é¤˜ç¥¨æ•¸</div></div><div class="stat-item"><div class="stat-number">${T.refreshesRemaining}</div><div class="stat-label">ğŸ”„ åˆ·æ–°æ¬¡æ•¸</div></div></div><div id="votingArea"></div><button onclick="window.refreshPair()">ğŸ”„ æ›ä¸€å°</button><button class="secondary-btn" onclick="window.backToLogin()">â†©ï¸ ç™»å‡º</button>`,V()}function V(){const t=document.getElementById("votingArea");if(T.votesRemaining<=0)return void(t.innerHTML='<div class="error">ä½ çš„ç¥¨æ•¸å·²ç”¨å®Œï¼</div>');if(L.length<2)return void(t.innerHTML='<div class="error">ä½œå“æ•¸é‡ä¸è¶³ï¼Œç„¡æ³•é€²è¡ŒæŠ•ç¥¨</div>');let e,a=0;do{const t=[...L].sort(()=>Math.random()-.5);e=[t[0],t[1]],a++}while(T.votedPairs.includes(`${e[0].id}-${e[1].id}`)&&T.votedPairs.includes(`${e[1].id}-${e[0].id}`)&&a<10);t.innerHTML=`<div class="images-container"><div class="image-option" onclick="window.showVoteConfirm('${e[0].id}', '${e[1].id}', '${e[0].title}', '${e[0].imageUrl}')"><img src="${e[0].imageUrl}" alt="${e[0].title}"><div class="image-option-title">${e[0].title}</div></div><div class="image-option" onclick="window.showVoteConfirm('${e[1].id}', '${e[0].id}', '${e[1].title}', '${e[1].imageUrl}')"><img src="${e[1].imageUrl}" alt="${e[1].title}"><div class="image-option-title">${e[1].title}</div></div></div>`}function R(t){const e=document.getElementById("app"),a=document.createElement("div");a.className="error",a.textContent=t,e.insertBefore(a,e.firstChild),setTimeout(()=>a.remove(),5e3)}function G(t){const e=document.getElementById("app"),a=document.createElement("div");a.className="success",a.textContent=t,e.insertBefore(a,e.firstChild),setTimeout(()=>a.remove(),3e3)}function $(t,e,a){const i=document.createElement("div");i.className="modal-overlay",i.innerHTML=`<div class="${t}">${e}</div>`,document.body.appendChild(i),a&&setTimeout(()=>{i.remove()},a)}window.showVoteConfirm=function(t,e,a,i){$("modal-overlay",`<div class="confirm-modal"><h2>ç¢ºå®šæŠ•ç¥¨ï¼Ÿ</h2><img src="${i}" class="confirm-image" alt="${a}"><div class="confirm-title">${a}</div><div class="confirm-text">ç¢ºå®šè¦æŠ•çµ¦é€™å€‹ä½œå“å—ï¼Ÿ<br>æŠ•ç¥¨å¾Œå°‡ç„¡æ³•æ›´æ”¹ï¼</div><div class="confirm-buttons"><button class="secondary-btn" onclick="window.closeModal()">âŒ å–æ¶ˆ</button><button onclick="window.confirmVote('${t}', '${e}')">âœ… ç¢ºå®šæŠ•ç¥¨</button></div></div>`)},window.closeModal=function(){const t=document.querySelector(".modal-overlay");t&&t.remove()},window.confirmVote=async function(t,e){if(window.closeModal(),!P())return R("æŠ•ç¥¨æ™‚é–“å·²çµæŸ"),void _();try{const a=Date.now(),n={voter:T.name,timestamp:a,date:new Date(a).toLocaleString("zh-TW")};await l(i(k,"submissions",t),{score:d(1),votes:u(n)}),T.votesRemaining--,T.votedPairs.push(`${t}-${e}`),await l(i(k,"users",T.name),{votesRemaining:T.votesRemaining,votedPairs:T.votedPairs}),$("modal-overlay",'<div class="success-modal"><h2>æŠ•ç¥¨æˆåŠŸï¼</h2><div class="success-icon"></div><div class="success-message">ğŸ‰ ä½ çš„æŠ•ç¥¨å·²æˆåŠŸé€å‡ºï¼<br>å‰©é¤˜ç¥¨æ•¸ï¼š'+T.votesRemaining+'</div><button onclick="window.closeModalAndRefresh()">ç¹¼çºŒæŠ•ç¥¨</button></div>',3e3),setTimeout(()=>O(),3e3)}catch(t){console.error("æŠ•ç¥¨å¤±æ•—:",t),R("æŠ•ç¥¨å¤±æ•—ï¼Œè«‹é‡è©¦")}},window.closeModalAndRefresh=function(){window.closeModal(),O()},window.userLogin=async function(){if(!P())return void R("ç›®å‰ä¸åœ¨æŠ•ç¥¨æ™‚é–“å…§");const t=document.getElementById("userName").value.trim();if(!t)return void R("è«‹è¼¸å…¥å§“å");try{const e=await n(i(k,"users",t));e.exists()?T=e.data():(T={name:t,votesRemaining:E.maxVotes,refreshesRemaining:E.maxRefreshes,votedPairs:[]},await o(i(k,"users",t),T)),O()}catch(t){console.error("ç™»å…¥å¤±æ•—:",t),R("ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦")}},window.showAdminLogin=function(){document.getElementById("app").innerHTML='<h1>ğŸ„ å¾Œå°ç®¡ç†ç™»å…¥ ğŸ…</h1><div class="input-group"><label>Email</label><input type="email" id="adminEmail" placeholder="è¼¸å…¥ç®¡ç†å“¡ Email"></div><div class="input-group"><label>å¯†ç¢¼</label><input type="password" id="adminPassword" placeholder="è¼¸å…¥å¯†ç¢¼"></div><button onclick="window.adminLogin()">ğŸ ç™»å…¥</button><button class="secondary-btn" onclick="window.backToLogin()">â†©ï¸ è¿”å›</button>'},window.adminLogin=async function(){const t=document.getElementById("adminEmail").value.trim(),e=document.getElementById("adminPassword").value;if(!t||!e)return void R("è«‹è¼¸å…¥ Email å’Œå¯†ç¢¼");try{await h(S,t,e)}catch(t){console.error("ç™»å…¥å¤±æ•—:",t),"auth/invalid-credential"===t.code?R("Email æˆ–å¯†ç¢¼éŒ¯èª¤"):R("ç™»å…¥å¤±æ•—ï¼š"+t.message)}},window.adminLogout=async function(){try{await f(S),_()}catch(t){R("ç™»å‡ºå¤±æ•—")}},window.refreshPair=async function(){if(T.refreshesRemaining<=0)return void R("åˆ·æ–°æ¬¡æ•¸å·²ç”¨å®Œï¼");try{T.refreshesRemaining--,await l(i(k,"users",T.name),{refreshesRemaining:T.refreshesRemaining}),O()}catch(t){R("åˆ·æ–°å¤±æ•—")}},window.deleteVote=async function(t,e){if(!confirm(`ç¢ºå®šè¦åˆªé™¤ ${e.voter} çš„æŠ•ç¥¨å—ï¼Ÿ`))return;try{await l(i(k,"submissions",t),{votes:p(e),score:d(-1)}),G("æŠ•ç¥¨è¨˜éŒ„å·²åˆªé™¤ï¼"),setTimeout(()=>D(),1e3)}catch(t){console.error("åˆªé™¤æŠ•ç¥¨å¤±æ•—:",t),R("åˆªé™¤æŠ•ç¥¨å¤±æ•—")}},window.updateVotingTime=async function(){try{const t=document.getElementById("startTimeInput").value,e=document.getElementById("endTimeInput").value;if(t&&e&&new Date(t)>=new Date(e))return void R("çµæŸæ™‚é–“å¿…é ˆæ™šæ–¼é–‹å§‹æ™‚é–“");await l(i(k,"settings","config"),{votingStartTime:t||null,votingEndTime:e||null}),E.votingStartTime=t||null,E.votingEndTime=e||null,G("æŠ•ç¥¨æ™‚é–“æ›´æ–°æˆåŠŸï¼"),setTimeout(()=>D(),1e3)}catch(t){R("æ›´æ–°æ™‚é–“å¤±æ•—")}},window.clearVotingTime=async function(){if(!confirm("ç¢ºå®šè¦æ¸…é™¤æ™‚é–“é™åˆ¶å—ï¼Ÿ"))return;try{await l(i(k,"settings","config"),{votingStartTime:null,votingEndTime:null}),E.votingStartTime=null,E.votingEndTime=null,G("æ™‚é–“é™åˆ¶å·²æ¸…é™¤ï¼"),setTimeout(()=>D(),1e3)}catch(t){R("æ¸…é™¤æ™‚é–“å¤±æ•—")}},window.toggleLeaderboardImages=async function(){try{E.showLeaderboardImages=!E.showLeaderboardImages,await l(i(k,"settings","config"),{showLeaderboardImages:E.showLeaderboardImages}),G(E.showLeaderboardImages?"å·²é–‹å•Ÿæ’è¡Œæ¦œåœ–ç‰‡é¡¯ç¤º":"å·²é—œé–‰æ’è¡Œæ¦œåœ–ç‰‡é¡¯ç¤º"),setTimeout(()=>D(),1e3)}catch(t){console.error("æ›´æ–°è¨­å®šå¤±æ•—:",t),R("æ›´æ–°è¨­å®šå¤±æ•—")}},window.saveGitHubToken=function(){const t=document.getElementById("githubTokenInput").value.trim();if(!t)return void R("è«‹è¼¸å…¥ GitHub Token");if(!t.startsWith("ghp_")&&!t.startsWith("github_pat_"))return void R("Token æ ¼å¼ä¸æ­£ç¢º");localStorage.setItem("githubToken",t),I=t,G("Token å„²å­˜æˆåŠŸï¼"),setTimeout(()=>D(),1e3)},window.clearGitHubToken=function(){confirm("ç¢ºå®šè¦æ¸…é™¤ GitHub Token å—ï¼Ÿ")&&(localStorage.removeItem("githubToken"),I="",G("Token å·²æ¸…é™¤"),setTimeout(()=>D(),1e3))},window.previewImage=function(t){const e=t.target.files[0];if(e){const t=(e.size/1024/1024).toFixed(2),a=document.getElementById("fileSizeDisplay");a.textContent=`æª”æ¡ˆå¤§å°ï¼š${t} MB`,e.size>2097152?(a.style.color="#c62828",a.textContent+=" âš ï¸ å»ºè­°å°æ–¼ 2 MB"):(a.style.color="#2e7d32",a.textContent+=" âœ“");const i=new FileReader;i.onload=function(t){const e=document.getElementById("imagePreview");e.src=t.target.result,e.classList.remove("hidden")},i.readAsDataURL(e)}},window.updateTheme=async function(){const t=document.getElementById("themeInput").value.trim();if(!t)return void R("è«‹è¼¸å…¥ä¸»é¡Œ");try{await l(i(k,"settings","config"),{theme:t}),E.theme=t,G("ä¸»é¡Œæ›´æ–°æˆåŠŸï¼"),setTimeout(()=>D(),1e3)}catch(t){console.error("æ›´æ–°ä¸»é¡Œå¤±æ•—:",t),R("æ›´æ–°ä¸»é¡Œå¤±æ•—")}},window.uploadSubmission=async function(){const t=document.getElementById("submissionTitle").value.trim(),e=document.getElementById("submissionImage").files[0];if(!t||!e)return void R("è«‹å¡«å¯«æ¨™é¡Œä¸¦é¸æ“‡åœ–ç‰‡");if(!I)return void R("è«‹å…ˆè¨­å®š GitHub Token");try{const a=document.getElementById("uploadBtn"),n=document.getElementById("uploadProgress"),s=document.getElementById("uploadProgressFill");a.disabled=!0,n.classList.remove("hidden"),s.style.width="30%",s.textContent="ä¸Šå‚³ä¸­...";const r=await U(e);s.style.width="70%",s.textContent="å„²å­˜è³‡æ–™...";const l=Date.now();await o(i(k,"submissions",`submission_${l}`),{title:t,imageUrl:r.url,imagePath:r.path,score:0,votes:[],createdAt:l}),s.style.width="100%",s.textContent="å®Œæˆï¼",G("ä¸Šå‚³æˆåŠŸï¼"),setTimeout(()=>D(),1500)}catch(t){console.error("ä¸Šå‚³å¤±æ•—:",t),R("ä¸Šå‚³å¤±æ•—ï¼š"+t.message),document.getElementById("uploadBtn").disabled=!1,document.getElementById("uploadProgress").classList.add("hidden")}},window.deleteSubmission=async function(t,e){if(!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œå“å—ï¼Ÿ"))return;try{e&&await j(e),await r(i(k,"submissions",t)),G("åˆªé™¤æˆåŠŸï¼"),setTimeout(()=>D(),1e3)}catch(t){console.error("åˆªé™¤å¤±æ•—:",t),R("åˆªé™¤å¤±æ•—")}},window.updateLeaderboard=async function(){try{G("æ­£åœ¨æ›´æ–°æ’è¡Œæ¦œ...");const t=c(a(k,"submissions"),m("score","desc"),g(10)),e=(await s(t)).docs.map((t,e)=>({rank:e+1,...t.data()}));await o(i(k,"settings","leaderboard"),{data:e,updatedAt:Date.now()}),G("æ’è¡Œæ¦œæ›´æ–°æˆåŠŸï¼")}catch(t){console.error("æ›´æ–°æ’è¡Œæ¦œå¤±æ•—:",t),R("æ›´æ–°æ’è¡Œæ¦œå¤±æ•—")}},window.showLeaderboard=async function(){try{const t=await n(i(k,"settings","leaderboard")),e=document.getElementById("app");if(e.className="container leaderboard-container",!t.exists()||!t.data().data)return void(e.innerHTML='<h1>ğŸ† æ’è¡Œæ¦œ ğŸ„</h1><div class="error">æš«ç„¡æ’è¡Œæ•¸æ“š</div><button class="secondary-btn" onclick="window.backToLogin()">â†©ï¸ è¿”å›</button>');const a=t.data(),o=a.data,s=a.updatedAt,r=E.showLeaderboardImages,l=s?new Date(s).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"æœªçŸ¥";e.innerHTML=`<h1>ğŸ† æ’è¡Œæ¦œ ğŸ„</h1><div class="leaderboard-notice"><div class="leaderboard-notice-title">éå¯¦æ™‚æ›´æ–°</div><div class="leaderboard-notice-text">æ’è¡Œæ¦œæ•¸æ“šç”±ç®¡ç†å“¡æ‰‹å‹•æ›´æ–°ï¼Œ<br>ä¸æœƒå³æ™‚åæ˜ æœ€æ–°æŠ•ç¥¨çµæœ</div></div><div class="leaderboard-update-time">ä¸Šæ¬¡æ›´æ–°ï¼š${l}</div>${o.map(t=>`<div class="leaderboard-item"><div class="rank">#${t.rank}</div>${r?`<img src="${t.imageUrl}" class="leaderboard-image" alt="${t.title}">`:""}<div class="leaderboard-info"><div class="leaderboard-title">${t.title}</div><div class="leaderboard-score">â­ å¾—åˆ†: ${t.score||0}</div></div></div>`).join("")}<button class="secondary-btn" onclick="window.backToLogin()">â†©ï¸ è¿”å›</button>`}catch(t){R("è¼‰å…¥æ’è¡Œæ¦œå¤±æ•—")}},window.backToLogin=function(){T=null,_()},C();</script>
</body>
</html>
